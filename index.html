<!DOCTYPE html>
<html>
<head>
    <title>Trippy Tilt Runner</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Courier New', Courier, monospace; }
        
        #ui-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; background: rgba(0,0,0,0.8); z-index: 10; }
        
        #reset-container { position: absolute; top: 20px; width: 100%; display: none; justify-content: center; z-index: 5; }
        
        button { 
            padding: 12px 24px; font-size: 1rem; cursor: pointer; border-radius: 50px; border: 2px solid #fff; 
            background: transparent; color: white; text-transform: uppercase; letter-spacing: 2px;
            transition: all 0.2s;
        }
        button:active { transform: scale(0.9); background: white; color: black; }
        
        h1 { color: #0f0; text-shadow: 0 0 10px #0f0; margin-bottom: 5px; }
        p { color: #fff; margin-bottom: 20px; font-size: 0.8rem; }
    </style>
</head>
<body>

    <div id="ui-overlay">
        <h1>NEON DRIFT</h1>
        <p>TILT TO LOOK | HTTPS REQUIRED</p>
        <button id="startBtn">ENTER VOID</button>
    </div>

    <div id="reset-container">
        <button id="resetBtn">RESET PERSPECTIVE</button>
    </div>

    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }
    </script>

    <script type="module">
        import * as THREE from 'three';

        let scene, camera, renderer, road, material;
        let currentTiltX = 0, currentTiltY = 0;
        let offsetX = 0, offsetY = 0;
        let hue = 0;

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000000);
            scene.fog = new THREE.Fog(0x000000, 5, 45);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // Create the Road with a Line material for that retro look
            const geometry = new THREE.PlaneGeometry(30, 1000, 20, 100);
            material = new THREE.MeshBasicMaterial({ 
                color: 0x00ff00, 
                wireframe: true,
                transparent: true,
                opacity: 0.8
            });
            
            road = new THREE.Mesh(geometry, material);
            road.rotation.x = -Math.PI / 2;
            scene.add(road);

            camera.position.y = 2;
            animate();
        }

        function animate() {
            requestAnimationFrame(animate);

            // 1. Trippy Color Logic (HSL)
            hue += 0.005; 
            if (hue > 1) hue = 0;
            // Set color using Hue, Saturation (100%), Lightness (50%)
            material.color.setHSL(hue, 1, 0.5);

            // 2. Movement
            road.position.z += 0.4;
            if (road.position.z > 50) road.position.z = 0;

            // 3. Camera Rotation with Reset Offset applied
            const targetRotY = -(currentTiltX - offsetX) * 0.02;
            const targetRotX = (currentTiltY - offsetY) * 0.01;

            camera.rotation.y = THREE.MathUtils.lerp(camera.rotation.y, targetRotY, 0.1);
            camera.rotation.x = THREE.MathUtils.lerp(camera.rotation.x, targetRotX, 0.1);

            renderer.render(scene, camera);
        }

        // Permission & Start Logic
        document.getElementById('startBtn').addEventListener('click', async () => {
            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                const permission = await DeviceOrientationEvent.requestPermission();
                if (permission === 'granted') startSensors();
            } else {
                startSensors();
            }
        });

        function startSensors() {
            document.getElementById('ui-overlay').style.display = 'none';
            document.getElementById('reset-container').style.display = 'flex';
            
            window.addEventListener('deviceorientation', (event) => {
                currentTiltX = event.gamma;
                currentTiltY = event.beta;
            });
            init();
        }

        // Reset Perspective Logic
        document.getElementById('resetBtn').addEventListener('click', () => {
            // Save the current tilt as the new "zero"
            offsetX = currentTiltX;
            offsetY = currentTiltY;
        });

        // Handle window resizing
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
