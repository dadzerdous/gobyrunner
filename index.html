<!DOCTYPE html>
<html>
<head>
    <title>Tilt Runner Prototype</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: sans-serif; }
        #ui { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; text-align: center; }
        button { padding: 15px 30px; font-size: 1.2rem; cursor: pointer; border-radius: 10px; border: none; background: #2ecc71; color: white; }
    </style>
</head>
<body>

    <div id="ui">
        <h1>Tilt Runner</h1>
        <p>Tilt your phone to look around the map</p>
        <button id="startBtn">START GAME</button>
    </div>

    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }
    </script>

    <script type="module">
        import * as THREE from 'three';

        let scene, camera, renderer, road;
        let tiltX = 0, tiltY = 0;

        function init() {
            // 1. Setup Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x111122);
            scene.fog = new THREE.Fog(0x111122, 10, 50);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // 2. Create a "Road" (The Map)
            const geometry = new THREE.PlaneGeometry(20, 1000, 10, 100);
            const material = new THREE.MeshBasicMaterial({ color: 0x444444, wireframe: true });
            road = new THREE.Mesh(geometry, material);
            road.rotation.x = -Math.PI / 2;
            scene.add(road);

            camera.position.y = 1.5; // Height of the player's eyes
            animate();
        }

        function animate() {
            requestAnimationFrame(animate);

            // Move forward (Endless effect)
            road.position.z += 0.2;
            if (road.position.z > 100) road.position.z = 0;

            // Apply Tilt to Camera Rotation
            // Gamma is left/right tilt, Beta is front/back
            camera.rotation.y = THREE.MathUtils.lerp(camera.rotation.y, -tiltX * 0.02, 0.1);
            camera.rotation.x = THREE.MathUtils.lerp(camera.rotation.x, tiltY * 0.01, 0.1);

            renderer.render(scene, camera);
        }

        // Handle Permissions for iOS/Android
        document.getElementById('startBtn').addEventListener('click', async () => {
            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                // iOS 13+ requires explicit permission
                const permission = await DeviceOrientationEvent.requestPermission();
                if (permission === 'granted') startSensors();
            } else {
                // Android & older iOS
                startSensors();
            }
            document.getElementById('ui').style.display = 'none';
        });

        function startSensors() {
            window.addEventListener('deviceorientation', (event) => {
                tiltX = event.gamma; // Range: -90 to 90
                tiltY = event.beta;  // Range: -180 to 180
            });
            init();
        }
    </script>
</body>
</html>
